(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{4830:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return t(4153)}])},1513:function(e,n,t){"use strict";t.d(n,{o:function(){return i}});var r=t(5893),a=t(1163),s=t(416);function i(e){let{placeholder:n="Buscar...",className:t,queryName:i="search"}=e,o=(0,a.useRouter)(),l=o.query[i]||"",c=()=>{let e=o.query;delete e[i],o.replace({query:e})};return(0,r.jsx)(s.Z,{placeholder:n,icon:{link:!0,name:l?"close":"search",onClick:c},className:t,value:l,onChange:(e,n)=>{n.value?o.replace({query:{...o.query,[i]:n.value}}):c()}})}},9914:function(e,n,t){"use strict";t.d(n,{gb:function(){return l},u_:function(){return x},xM:function(){return p},tl:function(){return C},ol:function(){return Z.o},Z0:function(){return s}});var r=t(5893),a=t(849);function s(e){let{height:n}=e;return(0,r.jsx)("div",{style:{height:n}})}var i=t(1114),o=t.n(i);function l(e){let{text:n="Cargando",top:t=0}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s,{height:t}),(0,r.jsx)(a.Z,{active:!0,inline:"centered",className:o().loading,children:n})]})}var c=t(711),d=t(7294),u=t(3625),h=t(967);let x={Basic:function(e){let{children:n,show:t,onClose:a,title:s}=e;return(0,r.jsxs)(c.Z,{open:t,onClose:a,size:"small",children:[(0,r.jsx)(c.Z.Header,{children:s}),(0,r.jsx)(c.Z.Content,{children:n})]})},Confirm:function(e){let{onConfirm:n,...t}=e,[a,s]=(0,d.useState)(!1);return(0,r.jsx)(u.Z,{className:"confirm",size:"mini",onConfirm:()=>{s(!0),n()},confirmButton:(0,r.jsx)(h.Z,{primary:!0,loading:a,children:"Ok"}),...t})}};var j=t(6417),m=t.n(j);function p(e){let{text:n="No hay resultados"}=e;return(0,r.jsx)("div",{className:m().noResult,children:(0,r.jsx)("p",{children:n})})}var g=t(1163),f=t(3068),_=t(7463),v=t.n(_);function C(e){let{currentPage:n,totalPages:t}=e,a=(0,g.useRouter)();return(0,r.jsx)("div",{className:v().container,children:(0,r.jsx)(f.Z,{defaultActivePage:n,totalPages:t,ellipsisItem:null,firstItem:null,lastItem:null,onPageChange:(e,n)=>{let{activePage:t}=n;a.replace({query:{...a.query,page:t}})}})})}var Z=t(1513)},5646:function(e,n,t){"use strict";t.d(n,{a:function(){return s}});var r=t(7294),a=t(5900);let s=()=>(0,r.useContext)(a.V)},4836:function(e,n,t){"use strict";t.d(n,{i:function(){return w},e:function(){return I}});var r=t(5893),a=t(1163),s=t(7294),i=t(5712),o=t(5150),l=t(8081),c=t.n(l);let d=[{description:"Ten el control de todos tus pedidos y recibe notificaciones con el seguimiento",icon:"truck",title:"Gestiona tus pedidos"},{description:"Agente para atenderte las 24 horas del dia y los 7 dias de la semana",icon:"wechat",title:"Atenci\xf3n al cliente"}];var u=t(1664),h=t.n(u),x=t(46),j=t.n(x),m=t(5646),p=t(7361),g=t.n(p),f=t(5142),_=t(2773),v=t.n(_),C=t(2548),Z=t.n(C),P=t(8010),y=t(7257);let b={Account:function(){let{user:e}=(0,m.a)();return(0,r.jsxs)(h(),{href:e?"/account":"/join/login",className:j().account,children:[(0,r.jsx)(o.Z,{name:"user"}),e&&e.userEmail?"".concat(e.userEmail.slice(0,14),"..."):"Entrar"]})},AdminButton:function(){return(0,r.jsxs)(h(),{href:"/admin",className:g().adminButton,children:[(0,r.jsx)(o.Z,{name:"configure"}),"Admin"]})},Basket:function(){return(0,r.jsxs)(h(),{href:"/basket",className:v().basket,children:[(0,r.jsx)(o.Z,{name:"cart"}),(0,r.jsx)(f.Z,{color:"teal",circular:!0,children:6}),"Mi cesta"]})},CategoriesMenu:function(){let[e,n]=(0,s.useState)([]);return(0,s.useEffect)(()=>{(async()=>{try{let e=await P.J.getAll();n(e)}catch(e){console.error(e)}})()},[]),(0,r.jsx)("div",{className:Z().container,children:e&&e.map(e=>(0,r.jsx)(h(),{href:"/categories/".concat(e.categPath),children:e.categName},e.categId))})},Logo:function(){return(0,r.jsx)(h(),{href:"/",children:(0,r.jsx)(y.Z,{src:"/images/logo-texto.png",alt:"Gambit"})})}};function I(e){let{children:n}=e,t=(0,m.a)(),l=(0,a.useRouter)();return((0,s.useEffect)(()=>{t||l.push("/")},[l,t]),t)?(0,r.jsxs)(i.Z,{className:c().container,children:[(0,r.jsx)(b.Logo,{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:c().left,children:d.map((e,n)=>(0,r.jsxs)("div",{children:[(0,r.jsx)(o.Z,{name:e.icon}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:e.title}),(0,r.jsx)("span",{children:e.description})]})]},n))}),(0,r.jsx)("div",{className:c().right,children:n})]})]}):null}var N=t(8067),k=t.n(N),S=t(1513);function w(e){let{children:n}=e,{isAdmin:t}=(0,m.a)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:k().border,children:(0,r.jsxs)(i.Z,{className:k().header,children:[(0,r.jsxs)("div",{className:k().left,children:[(0,r.jsx)(b.Logo,{}),(0,r.jsx)(S.o,{className:k().search,placeholder:"Busca lo que necesitas..."})]}),(0,r.jsxs)("div",{children:[t&&(0,r.jsx)(b.AdminButton,{}),(0,r.jsx)(b.Account,{}),(0,r.jsx)(b.Basket,{})]})]})}),(0,r.jsx)("div",{className:k().border,children:(0,r.jsx)(i.Z,{children:(0,r.jsx)(b.CategoriesMenu,{})})}),n]})}},4153:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return q}});var r=t(5893),a=t(1163),s=t(7294),i=t(5806),o=t(5712),l=t(254),c=t.n(l),d=t(5927),u=t(1018),h=t(9914);let x={ListCategories:function(e){let{reload:n,onReload:t}=e,[a,i]=(0,s.useState)([]);return((0,s.useEffect)(()=>{(async()=>{try{let e=await u.Jz.getAll();i(e)}catch(e){console.error(e)}})()},[n]),a)?(0,r.jsxs)(d.Z,{striped:!0,children:[(0,r.jsx)(d.Z.Header,{children:(0,r.jsxs)(d.Z.Row,{children:[(0,r.jsx)(d.Z.HeaderCell,{children:"ID"}),(0,r.jsx)(d.Z.HeaderCell,{children:"Title"}),(0,r.jsx)(d.Z.HeaderCell,{children:"Slug"}),(0,r.jsx)(d.Z.HeaderCell,{})]})}),(0,r.jsxs)(d.Z.Body,{children:[0===a.length&&(0,r.jsx)(d.Z.Cell,{colSpan:"5",children:(0,r.jsx)(h.xM,{text:"No hay categorias"})}),(0,r.jsx)("p",{children:"Lista de categorias"})]})]}):(0,r.jsx)(h.gb,{text:"Cargando categorias"})}};var j=t(967),m=t(918),p=t(6443),g=t(4428),f=t(6310),_=t(2351);function v(e){let{onClose:n,onReload:t,product:a}=e,[i,o]=(0,s.useState)([]);(0,s.useEffect)(()=>{(async()=>{try{let e=(await u.Jz.getAll()).map(e=>({key:e.categId,text:e.categName,value:e.categId}));o(e)}catch(e){console.error(e)}})()},[]);let l=(0,p.TA)({initialValues:{ProdCategId:(null==a?void 0:a.prodCategId)||null,ProdDescription:(null==a?void 0:a.prodDescription)||"",ProdPath:(null==a?void 0:a.prodPath)||"",ProdPrice:(null==a?void 0:a.prodPrice)||"",ProdStock:(null==a?void 0:a.prodStock)||"",ProdTitle:(null==a?void 0:a.prodTitle)||""},onSubmit:async e=>{try{a?await u.Jb.update(e,a.prodId):await u.Jb.create(e),t(),n()}catch(e){console.error(e)}},validateOnChange:!1,validationSchema:f.Ry({ProdCategId:f.Rx().required(),ProdDescription:f.Z_().required(),ProdPath:f.Z_().required(),ProdPrice:f.Rx().required(),ProdStock:f.Rx().required(),ProdTitle:f.Z_().required()})});return(0,r.jsxs)(g.Z,{onSubmit:l.handleSubmit,children:[(0,r.jsx)(g.Z.Input,{name:"ProdTitle",placeholder:"Nombre",value:l.values.ProdTitle,onChange:l.handleChange,error:l.errors.ProdTitle}),(0,r.jsx)(g.Z.Input,{name:"ProdPath",placeholder:"Slug",value:l.values.ProdPath,onChange:l.handleChange,error:l.errors.ProdPath}),(0,r.jsx)(m.M,{apiKey:_.Vi.TINY_APIKEY,init:{height:400,menubar:!0,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","code","help","wordcount"],toolbar:"undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help"},initialValue:l.values.ProdDescription,onBlur:e=>l.setFieldValue("ProdDescription",e.target.getContent())}),(0,r.jsx)(h.Z0,{height:20}),(0,r.jsx)(g.Z.Dropdown,{name:"ProdCategId",placeholder:"Categoria del producto",search:!0,selection:!0,fluid:!0,options:i,value:l.values.ProdCategId,error:l.errors.ProdCategId,onChange:(e,n)=>l.setFieldValue("ProdCategId",n.value)}),(0,r.jsxs)(g.Z.Group,{widths:"equal",children:[(0,r.jsx)(g.Z.Input,{type:"number",name:"ProdPrice",placeholder:"Precio",value:l.values.ProdPrice,onChange:l.handleChange,error:l.errors.ProdPrice}),(0,r.jsx)(g.Z.Input,{type:"number",name:"ProdStock",placeholder:"Stock",value:l.values.ProdStock,onChange:l.handleChange,error:l.errors.ProdStock})]}),(0,r.jsx)(g.Z.Button,{type:"submit",fluid:!0,loading:l.isSubmitting,children:"Enviar"})]})}var C=t(7257),Z=t(5150),P=t(1582),y=t(8257),b=t.n(y);function I(e){let{onClose:n,onReload:t,productId:a}=e,[i,o]=(0,s.useState)(!1),l=(0,p.TA)({initialValues:{file:new Blob([],{type:"application/octet-stream"}),preview:null},onSubmit:async e=>{try{o(!0);let r=new FileReader;r.readAsArrayBuffer(e.file),r.onload=async()=>{let e=r.result;await u.Jb.updateImage(a,e),t(),n()}}catch(e){console.error()}},validateOnChange:!1,validationSchema:f.Ry({file:f.Z_().required()})}),c=(0,s.useCallback)(e=>{let n=e[0];l.setFieldValue("file",n),l.setFieldValue("preview",URL.createObjectURL(n))},[]),{getRootProps:d,getInputProps:h}=(0,P.uI)({accept:{"image/jpeg":[".jpeg"]},maxSize:10485760,multiple:!1,onDrop:c}),x=()=>l.values.file?l.values.preview:null;return(0,r.jsxs)("form",{onSubmit:l.handleSubmit,children:[(0,r.jsxs)("div",{className:b().imageContainer,...d(),children:[(0,r.jsx)("input",{...h()}),x()?(0,r.jsx)(C.Z,{size:"small",src:x(),alt:"Image to update"}):(0,r.jsx)("div",{children:(0,r.jsx)("span",{children:"Arrastra la nueva imagen"})}),l.errors.file&&l.touched.file&&(0,r.jsx)("div",{className:b().error,children:l.errors.file.toString()})]}),(0,r.jsx)(j.Z,{primary:!0,fluid:!0,type:"submit",loading:i,children:"Enviar"})]})}var N=t(5033),k=t.n(N),S=t(2658);let w={checkIfImageExists:function(e,n){let t=new Image;t.src=e,t.complete?n(!0):(t.onload=()=>{n(!0)},t.onerror=()=>{n(!1)})},getUrlImage:function(e){return"".concat(S.V.IMG_URL,"/").concat(e,".jpg")}};function A(e){let{product:n,onReload:t}=e,[a,i]=(0,s.useState)("/images/not-found.jpg"),[o,l]=(0,s.useState)(!1),[c,x]=(0,s.useState)(!1),[j,m]=(0,s.useState)((0,r.jsx)("p",{}));(0,s.useEffect)(()=>{let e=w.getUrlImage(n.prodId);w.checkIfImageExists(e,n=>{n&&i(e)})},[n]);let p=()=>l(e=>!e),g=async()=>{try{await u.Jb.delete(n.prodId),t(),p()}catch(e){console.error(e)}},f=()=>{x(!1),m((0,r.jsx)("p",{}))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z.Cell,{children:n.prodId}),(0,r.jsx)(d.Z.Cell,{children:(0,r.jsx)(C.Z,{className:k().image,src:a,alt:n.prodTitle})}),(0,r.jsx)(d.Z.Cell,{children:n.prodTitle}),(0,r.jsxs)(d.Z.Cell,{children:[n.prodPrice,"€"]}),(0,r.jsxs)(d.Z.Cell,{children:[n.prodStock," Unidades"]}),(0,r.jsxs)(d.Z.Cell,{className:k().actions,children:[(0,r.jsx)(Z.Z,{name:"pencil",onClick:()=>{m((0,r.jsx)(v,{onClose:f,onReload:t,product:n})),x(!0)}}),(0,r.jsx)(Z.Z,{name:"image",link:!0,onClick:()=>{m((0,r.jsx)(I,{onClose:f,onReload:t,productId:n.prodId})),x(!0)}}),(0,r.jsx)(Z.Z,{name:"trash",link:!0,onClick:p})]}),(0,r.jsx)(h.u_.Confirm,{open:o,onCancel:p,onConfirm:g,content:"\xbfEstas seguro de eliminar el producto: (".concat(n.prodTitle,")?")}),(0,r.jsx)(h.u_.Basic,{show:c,onClose:f,title:"Editar (".concat(n.prodTitle,")"),children:j})]})}let R={AddProduct:function(e){let{onReload:n}=e,[t,a]=(0,s.useState)(!1),i=()=>a(e=>!e);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{primary:!0,onClick:i,children:"Nuevo producto"}),(0,r.jsx)(h.u_.Basic,{show:t,onClose:i,title:"Nuevo producto",children:(0,r.jsx)(v,{onClose:i,onReload:n})})]})},ListProducts:function(e){let{reload:n,onReload:t}=e,[i,o]=(0,s.useState)([]),[l,c]=(0,s.useState)(null),{query:x}=(0,a.useRouter)(),j=Number(x.page||1);return((0,s.useEffect)(()=>{(async()=>{try{o([]);let e=x&&x.searchAdmin?x.searchAdmin:"",n=await u.Jb.getAll(j,10,e);o(n.data||[]),c(Math.ceil(n.totalItems/10))}catch(e){console.error(e)}})()},[n,x.page,x.searchAdmin]),i)?(0,r.jsxs)("div",{children:[(0,r.jsxs)(d.Z,{striped:!0,children:[(0,r.jsx)(d.Z.Header,{children:(0,r.jsxs)(d.Z.Row,{children:[(0,r.jsx)(d.Z.HeaderCell,{children:"ID"}),(0,r.jsx)(d.Z.HeaderCell,{children:"Image"}),(0,r.jsx)(d.Z.HeaderCell,{children:"Nombre"}),(0,r.jsx)(d.Z.HeaderCell,{children:"Precio"}),(0,r.jsx)(d.Z.HeaderCell,{children:"Stock"})]})}),(0,r.jsxs)(d.Z.Body,{children:[0===i.length&&(0,r.jsx)(d.Z.Cell,{colSpan:"5",children:(0,r.jsx)(h.xM,{text:"No hay productos"})}),i.map(e=>(0,r.jsx)(d.Z.Row,{children:(0,r.jsx)(A,{product:e,onReload:t})},e.prodId))]})]}),(0,r.jsx)(h.tl,{currentPage:j,totalPages:l})]}):(0,r.jsx)(h.gb,{text:"Cargando productos"})}};var B=t(5646),E=t(4836);function q(){let[e,n]=(0,s.useState)(!1),{isAdmin:t}=(0,B.a)(),l=(0,a.useRouter)(),d=()=>n(e=>!e);if(!t)return l.push("/"),null;let u=[{menuItem:"Productos",render:()=>(0,r.jsxs)(i.Z.Pane,{children:[(0,r.jsxs)("div",{className:c().actions,children:[(0,r.jsx)(h.ol,{queryName:"searchAdmin"}),(0,r.jsx)(R.AddProduct,{onReload:d})]}),(0,r.jsx)(R.ListProducts,{reload:e,onReload:d})]})},{menuItem:"Categorias",render:()=>(0,r.jsxs)(i.Z.Pane,{children:[(0,r.jsxs)("div",{className:c().actions,children:[(0,r.jsx)("div",{}),(0,r.jsx)("span",{children:"Add category"})]}),(0,r.jsx)(x.ListCategories,{reload:e,onReload:d})]})},{menuItem:"Usuarios",render:()=>(0,r.jsx)(i.Z.Pane,{children:(0,r.jsx)("h2",{children:"Usuarios"})})}];return(0,r.jsx)(E.i,{children:(0,r.jsx)(o.Z,{children:(0,r.jsx)(i.Z,{panes:u,className:c().tabs})})})}},5033:function(e){e.exports={image:"Product_image__0j9dw",actions:"Product_actions__UMnk1"}},8257:function(e){e.exports={imageContainer:"ProductImageForm_imageContainer__EjKuQ"}},46:function(e){e.exports={account:"Account_account__q9qKT"}},7361:function(e){e.exports={adminButton:"AdminButton_adminButton__5YrkM"}},2773:function(e){e.exports={basket:"Basket_basket__8FRtH"}},2548:function(e){e.exports={container:"CategoriesMenu_container__Qq9aA"}},1114:function(e){e.exports={loading:"Loader_loading__C5H_N"}},6417:function(e){e.exports={noResult:"NoResult_noResult__8rI9y"}},7463:function(e){e.exports={container:"Pagination_container__swS01"}},8067:function(e){e.exports={border:"BasicLayout_border__aEJ_6",header:"BasicLayout_header__Ir5gC",left:"BasicLayout_left__jNp1l",search:"BasicLayout_search__AjyoK"}},8081:function(e){e.exports={container:"JoinLayout_container__U_bXI",left:"JoinLayout_left__bsy8g",right:"JoinLayout_right__PA5Xb"}},254:function(e){e.exports={tabs:"admin_tabs__9N0fJ",actions:"admin_actions__FyH71"}}},function(e){e.O(0,[546,246,763,888,774,179],function(){return e(e.s=4830)}),_N_E=e.O()}]);